name: Direct PushPlus Test

on:
  workflow_dispatch:

jobs:
  check_pushplus:
    runs-on: ubuntu-latest
    steps:
      - name: Pure Python Push Test
        env:
          PUSHPLUS_TOKEN: ${{ secrets.PUSHPLUS_TOKEN }}
        shell: python
        run: |
          import requests
          import os
          import sys

          token = os.environ.get('PUSHPLUS_TOKEN')
          if not token:
              print("错误：未在 GitHub Secrets 中找到 PUSHPLUS_TOKEN")
              sys.exit(1)

          url = 'http://www.pushplus.plus/send'
          data = {
              "token": token,
              "title": "GitHub Actions 测试消息",
              "content": "如果你收到这条消息，说明你的 Token 配置完全正确！",
              "template": "html"
          }
          
          print(f"正在向 PushPlus 发送请求...")
          response = requests.post(url, json=data)
          res_json = response.json()
          
          if res_json.get('code') == 200:
              print("✅ 发送成功！请检查手机微信。")
          else:
              print(f"❌ 发送失败！")
              print(f"返回代码: {res_json.get('code')}")
              print(f"错误消息: {res_json.get('msg')}")
              sys.exit(1)
